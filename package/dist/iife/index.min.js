"use strict";var VKTBridge=(function(){var I=Object.defineProperty;var nt=Object.getOwnPropertyDescriptor;var ot=Object.getOwnPropertyNames;var at=Object.prototype.hasOwnProperty;var it=function(t,e){for(var o in e)I(t,o,{get:e[o],enumerable:!0})},ut=function(t,e,o,a){if(e&&typeof e=="object"||typeof e=="function")for(var r=ot(e),n=0,i=r.length,c;n<i;n++)c=r[n],!at.call(t,c)&&c!==o&&I(t,c,{get:function(f){return e[f]}.bind(null,c),enumerable:!(a=nt(e,c))||a.enumerable});return t};var ct=function(t){return ut(I({},"__esModule",{value:!0}),t)};var _t={};it(_t,{instance:function(){return A},send:function(){return ft},subscribe:function(){return st}});function F(t,e,o,a,r,n,i){try{var c=t[n](i),f=c.value}catch(u){o(u);return}c.done?e(f):Promise.resolve(f).then(a,r)}function N(t){return function(){var e=this,o=arguments;return new Promise(function(a,r){var n=t.apply(e,o);function i(f){F(n,a,r,i,c,"next",f)}function c(f){F(n,a,r,i,c,"throw",f)}i(void 0)})}}function d(t,e){return e!=null&&typeof Symbol!="undefined"&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):d(t,e)}function E(t,e){if(!d(t,e))throw new TypeError("Cannot call a class as a function")}function s(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function T(t){if(Array.isArray(t))return t}function M(t,e){var o=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(o!=null){var a=[],r=!0,n=!1,i,c;try{for(o=o.call(t);!(r=(i=o.next()).done)&&(a.push(i.value),!(e&&a.length===e));r=!0);}catch(f){n=!0,c=f}finally{try{!r&&o.return!=null&&o.return()}finally{if(n)throw c}}return a}}function B(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(t,e){(e==null||e>t.length)&&(e=t.length);for(var o=0,a=new Array(e);o<e;o++)a[o]=t[o];return a}function x(t,e){if(t){if(typeof t=="string")return w(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);if(o==="Object"&&t.constructor&&(o=t.constructor.name),o==="Map"||o==="Set")return Array.from(o);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return w(t,e)}}function C(t,e){return T(t)||M(t,e)||x(t,e)||B()}function k(t){if(Array.isArray(t))return w(t)}function q(t){if(typeof Symbol!="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function K(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(t){return k(t)||q(t)||x(t)||K()}function m(t){"@swc/helpers - typeof";return t&&typeof Symbol!="undefined"&&t.constructor===Symbol?"symbol":typeof t}function S(t,e){var o={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},a,r,n,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function c(u){return function(_){return f([u,_])}}function f(u){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(o=0)),o;)try{if(a=1,r&&(n=u[0]&2?r.return:u[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,u[1])).done)return n;switch(r=0,n&&(u=[u[0]&2,n.value]),u[0]){case 0:case 1:n=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(n=o.trys,!(n=n.length>0&&n[n.length-1])&&(u[0]===6||u[0]===2)){o=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){o.label=u[1];break}if(u[0]===6&&o.label<n[1]){o.label=n[1],n=u;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(u);break}n[2]&&o.ops.pop(),o.trys.pop();continue}u=e.call(t,o)}catch(_){u=[6,_],r=0}finally{a=n=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},y(t)}function g(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!t})()}function V(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Y(t,e){return e&&(m(e)==="object"||typeof e=="function")?e:V(t)}function W(t,e,o){return e=y(e),Y(t,g()?Reflect.construct(e,o||[],y(t).constructor):e.apply(t,o))}function p(t,e){return p=Object.setPrototypeOf||function(a,r){return a.__proto__=r,a},p(t,e)}function H(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}function O(t,e,o){return g()?O=Reflect.construct:O=function(r,n,i){var c=[null];c.push.apply(c,n);var f=Function.bind.apply(r,c),u=new f;return i&&p(u,i.prototype),u},O.apply(null,arguments)}function Q(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function R(t){var e=typeof Map=="function"?new Map:void 0;return R=function(a){if(a===null||!Q(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(a))return e.get(a);e.set(a,r)}function r(){return O(a,arguments,y(this).constructor)}return r.prototype=Object.create(a.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),p(r,a)},R(t)}var z="BRIDGE_ERROR_TYPE",J=function(t){"use strict";H(e,t);function e(o,a){E(this,e);var r;return r=W(this,e,["".concat(o,": ").concat(a)]),s(r,"_error_type_",z),s(r,"code",void 0),s(r,"reason",void 0),r.code=o,r.reason=a,r}return e}(R(Error)),L=function(t){return(t==null?void 0:t._error_type_)===z};var b;(function(t){t.BAD_REQUEST="BAD_REQUEST",t.NETWORK_ERROR="NETWORK_ERROR",t.INTERNAL_ERROR="INTERNAL_ERROR",t.UNKNOWN_SUBSCRIPTION_NAME="UNKNOWN_SUBSCRIPTION_NAME"})(b||(b={}));function j(){if("crypto"in window&&window.crypto.randomUUID)return window.crypto.randomUUID();for(var t=new Date().getTime(),e=97,o=122,a="",r=0;r<30;r++){var n=Math.floor(Math.random()*(o-e+1))+e,i=String.fromCharCode(n);a+=i}return"".concat(t).concat(a)}var X=function(t){return"[Bridge]: ".concat(t)},v={log:function(t){for(var e=arguments.length,o=new Array(e>1?e-1:0),a=1;a<e;a++)o[a-1]=arguments[a];var r;(r=console).log.apply(r,[X(t)].concat(h(o)))},warn:function(t){for(var e=arguments.length,o=new Array(e>1?e-1:0),a=1;a<e;a++)o[a-1]=arguments[a];var r;(r=console).warn.apply(r,[X(t)].concat(h(o)))}};var Z=function(t){return t.map(function(e){return(typeof e=="undefined"?"undefined":m(e))==="object"?JSON.stringify(e):String(e)}).join(" ")};var P;(function(t){t.LoadingCompleted="LoadingCompleted",t.OpenProfile="OpenProfile",t.OpenDialog="OpenDialog",t.OpenThread="OpenThread",t.ForwardTask="ForwardTask",t.SetTitle="SetTitle",t.SetBadge="SetBadge",t.OpenLink="OpenLink",t.ShowToast="ShowToast",t.GetThemeSettings="GetThemeSettings",t.GetMiniAppShareLink="GetMiniAppShareLink",t.GetLanguage="GetLanguage",t.OpenPopUp="OpenPopUp",t.StoragePut="StoragePut",t.StorageGet="StorageGet",t.StorageDelete="StorageDelete",t.StorageClear="StorageClear",t.StartAudioCall="StartAudioCall",t.StartVideoCall="StartVideoCall",t.OpenAuthModal="OpenAuthModal",t.SetCanGoBack="SetCanGoBack",t.SetCanNotGoBack="SetCanNotGoBack",t.OpenContactSelectionDialog="OpenContactSelectionDialog",t.SetButtonGroup="SetButtonGroup",t.GetSelfId="GetSelfId",t.DownloadFile="DownloadFile",t.CreateChat="CreateChat",t.ForwardSurvey="ForwardSurvey",t.GetAuth="GetAuth",t.GetPlatformVersion="GetPlatformVersion",t.GetMiniappConfig="GetMiniappConfig",t.EnableLog="EnableLog"})(P||(P={}));var $;(function(t){t.ALREADY_CALLED="ALREADY_CALLED",t.PROFILE_NOT_FOUND="PROFILE_NOT_FOUND",t.DIALOG_NOT_FOUND="DIALOG_NOT_FOUND",t.THREAD_NOT_FOUND="THREAD_NOT_FOUND",t.POPUP_CLOSED="POPUP_CLOSED",t.KEY_IS_TOO_LARGE="KEY_IS_TOO_LARGE",t.VALUE_IS_TOO_LARGE="VALUE_IS_TOO_LARGE",t.TOTAL_LIMIT_EXCEEDED="TOTAL_LIMIT_EXCEEDED",t.INVALID_KEY="INVALID_KEY",t.INVALID_VALUE="INVALID_VALUE",t.KEY_NOT_FOUND="KEY_NOT_FOUND",t.USER_NOT_FOUND="USER_NOT_FOUND",t.MODAL_CLOSED="MODAL_CLOSED",t.UNKNOWN_GROUP="UNKNOWN_GROUP",t.UNKNOWN_ICON="UNKNOWN_ICON",t.CALLBACK_DATA_TOO_LARGE="CALLBACK_DATA_TOO_LARGE",t.TOO_MANY_BUTTONS="TOO_MANY_BUTTONS",t.CREATE_FAILED="CREATE_FAILED",t.UNAUTHTORIZED="401",t.FORBIDDEN="403",t.SERVER_ERROR="500"})($||($={}));var tt;(function(t){t.ThemeSettings="ThemeSettings",t.Language="Language",t.BackButtonPressed="BackButtonPressed",t.ButtonPressed="ButtonPressed"})(tt||(tt={}));var et=function t(){"use strict";var e=this,o=this;E(this,t);var a=this;s(this,"subscriptions",{}),s(this,"promises",{}),s(this,"enableLog",!0),s(this,"callBackHandlers",{newEvent:function(r,n){var i=e.subscriptions[r];if(!i){v.warn("no subscription found with id ".concat(r));return}i(n)}}),s(this,"callFunction",function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),c=1;c<n;c++)i[c-1]=arguments[c];var f=j(),u={type:"functionCall",data:{reqId:f,name:r,args:i}};return window.parent.postMessage(u,"*"),new Promise(function(_,l){o.promises[f]=[_,l]})}),s(this,"send",function(r,n){return e.callFunction("send",r,n)}),s(this,"subscribe",function(){var r=N(function(n,i){var c,f,u=arguments;return S(this,function(_){switch(_.label){case 0:return c=u.length>2&&u[2]!==void 0?u[2]:null,[4,a.callFunction("subscribe",n,c)];case 1:return f=_.sent().subscriptionId,a.subscriptions[f]=i,[2,{unsubscribe:a.getUnsubscribe(f)}]}})});return function(n,i){return r.apply(this,arguments)}}()),s(this,"setupConsoleProxy",function(){var r=["log","warn","info","error"],n=e.sendLog.bind(e);r.forEach(function(i){window.console[i]=new Proxy(console[i],{apply:function(f,u,_){n({type:i,text:Z(_)}),Reflect.apply(f,u,h(_))}})})}),s(this,"sendLog",function(r){var n=r.text,i=r.type;if(e.enableLog){var c=j(),f={type:"sendLog",data:{reqId:c,name:"sendLog",logData:{text:n,type:i}}};window.parent.postMessage(f,"*")}}),s(this,"changeEnableLog",function(){var r=N(function(n){var i;return S(this,function(c){switch(c.label){case 0:return i=n.enabled,a.enableLog=i,[4,a.send(P.EnableLog,{active:i})];case 1:return c.sent(),[2]}})});return function(n){return r.apply(this,arguments)}}()),s(this,"getUnsubscribe",function(r){return function(){r in e.subscriptions&&delete e.subscriptions[r]}}),s(this,"handleMessage",function(r){var n=r.data;if((typeof n=="undefined"?"undefined":m(n))==="object")switch(n.type){case"functionCallReply":e.handleFunctionCallReply(n.data);break;case"callBack":e.handleCallBack(r,n.data);break}}),s(this,"handleFunctionCallReply",function(r){var n=e.promises[r.reqId];if(n){delete e.promises[r.reqId];var i=C(n,2),c=i[0],f=i[1];r.ok!==void 0?c(r.ok):(v.warn("rejecting req ".concat(r.reqId," promise: ").concat(JSON.stringify(r.err))),f(r.err))}else v.warn("got reply to unknown function call with id ".concat(r.reqId))}),s(this,"handleCallBack",function(r,n){var i=function(l){var U=l.ok,G=l.err,D;if(U===void 0==(G===void 0))return i({reqId:n.reqId,err:{code:b.INTERNAL_ERROR,reason:"callBack handler protocol violation"}});var rt={type:"callBackReply",data:{reqId:n.reqId,ok:U,err:G}};(D=r.source)===null||D===void 0||D.postMessage(rt,r.origin)},c={reqId:n.reqId};try{var f=e.callBackHandlers[n.name];if(!f){var u='got callBack request with unknown name "'.concat(n.name,'"');throw v.warn(u),new J(b.BAD_REQUEST,u)}c.ok=f.apply(void 0,h(n.args))||null}catch(l){var _=L(l)?l.reason:"callBack handler raised an exception";d(l,Error)&&(_+=' "'.concat(l.name,'": "').concat(l.message,'"')),c.err={code:L(l)?l.code:b.INTERNAL_ERROR,reason:_}}i(c)}),window.addEventListener("message",this.handleMessage)};var A=new et,ft=A.send,st=A.subscribe;return ct(_t);})();
